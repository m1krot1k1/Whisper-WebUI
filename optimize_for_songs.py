bash #!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Whisper WebUI –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ø–µ—Å–µ–Ω
–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –≤–æ–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π
"""

import yaml
import os
from pathlib import Path

def optimize_for_songs():
    """–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ø–µ—Å–µ–Ω"""
    
    print("üéµ –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ø–µ—Å–µ–Ω...")
    
    config_file = "configs/default_parameters.yaml"
    
    if not os.path.exists(config_file):
        print(f"‚ùå –§–∞–π–ª {config_file} –Ω–µ –Ω–∞–π–¥–µ–Ω")
        return False
    
    # –ß–∏—Ç–∞–µ–º —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    with open(config_file, 'r', encoding='utf-8') as f:
        config = yaml.safe_load(f)
    
    # –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ø–µ—Å–µ–Ω
    print("üîß –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è –ø–µ—Å–µ–Ω...")
    
    # Whisper –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    config['whisper']['chunk_length'] = 60  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É —Å–µ–≥–º–µ–Ω—Ç–æ–≤
    config['whisper']['word_timestamps'] = True  # –í–∫–ª—é—á–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ —Å–ª–æ–≤
    config['whisper']['beam_size'] = 5  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º beam size –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
    config['whisper']['best_of'] = 5  # –ë–æ–ª—å—à–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∞
    config['whisper']['temperature'] = 0.0  # –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
    config['whisper']['repetition_penalty'] = 1.0  # –ù–µ –Ω–∞–∫–∞–∑—ã–≤–∞–µ–º –∑–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –≤ –ø–µ—Å–Ω—è—Ö
    config['whisper']['no_repeat_ngram_size'] = 0  # –†–∞–∑—Ä–µ—à–∞–µ–º –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
    config['whisper']['log_prob_threshold'] = -0.5  # –ë–æ–ª–µ–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥
    config['whisper']['no_speech_threshold'] = 0.4  # –ë–æ–ª–µ–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π –∫ —Ç–∏—Ö–æ–π —Ä–µ—á–∏
    
    # –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π prompt –¥–ª—è –ø–µ—Å–µ–Ω
    config['whisper']['initial_prompt'] = (
        "–≠—Ç–æ –ø–µ—Å–Ω—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ—á–Ω—ã–º, —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ä–∏—Ñ–º—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã. "
        "–í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ —Å–ª—É—à–∞–π –∫–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ –∏ —Ñ—Ä–∞–∑—É. –ü–µ—Å–Ω—è –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –ø—Ä–∏–ø–µ–≤—ã –∏ –∫—É–ø–ª–µ—Ç—ã. "
        "–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–π –≤–µ—Å—å —Ç–µ–∫—Å—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é, –≤–∫–ª—é—á–∞—è –≤—Å–µ –∫—É–ø–ª–µ—Ç—ã –∏ –ø—Ä–∏–ø–µ–≤—ã."
    )
    
    # Hotwords –¥–ª—è –ø–µ—Å–Ω–∏ "–ü—É—Å—Ç—å –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç —Å–æ–ª–Ω—Ü–µ"
    config['whisper']['hotwords'] = (
        "—Å–æ–ª–Ω–µ—á–Ω—ã–π, –∫—Ä—É–≥, –Ω–µ–±–æ, –≤–æ–∫—Ä—É–≥, —Ä–∏—Å—É–Ω–æ–∫, –º–∞–ª—å—á–∏—à–∫–∞, –Ω–∞—Ä–∏—Å–æ–≤–∞–ª, –ª–∏—Å—Ç–æ–∫, –ø–æ–¥–ø–∏—Å–∞–ª, —É–≥–æ–ª–æ–∫, "
        "–ø—É—Å—Ç—å, –≤—Å–µ–≥–¥–∞, —Å–æ–ª–Ω—Ü–µ, –º–∞–º–∞, –±—É–¥—É, –º–∏–ª—ã–π, –¥—Ä—É–≥, –¥–æ–±—Ä—ã–π, –ª—é–¥–∏, —Ö–æ—á–µ—Ç—Å—è, –º–∏—Ä–∞, —Ç—Ä–∏–¥—Ü–∞—Ç—å, "
        "–ø—è—Ç—å, —Å–µ—Ä–¥—Ü–µ, –æ–ø—è—Ç—å, —É—Å—Ç–∞–µ—Ç, –ø–æ–≤—Ç–æ—Ä—è—Ç—å, —Ç–∏—à–µ, —Å–æ–ª–¥–∞—Ç, —Å–ª—ã—à–∏—à—å, –ø—É–≥–∞—é—Ç—Å—è, –≤–∑—Ä—ã–≤–æ–≤, "
        "—Ç—ã—Å—è—á–∏, –≥–ª–∞–∑, –≥–ª—è–¥—è—Ç, –≥—É–±—ã, —É–ø—Ä—è–º–æ, —Ç–≤–µ—Ä–¥—è—Ç, –ø—Ä–æ—Ç–∏–≤, –±–µ–¥—ã, –≤–æ–π–Ω—ã, –≤—Å—Ç–∞–Ω–µ–º, –º–∞–ª—å—á–∏—à–µ–∫, "
        "—Å—á–∞—Å—Ç—å–µ, –Ω–∞–≤–µ–∫, –ø–æ–≤–µ–ª–µ–ª, —á–µ–ª–æ–≤–µ–∫"
    )
    
    # VAD –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ - –æ—Ç–∫–ª—é—á–∞–µ–º –¥–ª—è –ø–µ—Å–µ–Ω, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –º–æ–≥—É—Ç –æ–±—Ä–µ–∑–∞—Ç—å –≤–∞–∂–Ω—ã–µ —á–∞—Å—Ç–∏
    config['vad']['vad_filter'] = False  # –û—Ç–∫–ª—é—á–∞–µ–º VAD –¥–ª—è –ø–µ—Å–µ–Ω
    config['vad']['threshold'] = 0.3  # –ë–æ–ª–µ–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥
    config['vad']['min_speech_duration_ms'] = 100  # –ö–æ—Ä–æ—á–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
    config['vad']['min_silence_duration_ms'] = 500  # –ö–æ—Ä–æ—á–µ –ø–∞—É–∑—ã –º–µ–∂–¥—É —Ñ—Ä–∞–∑–∞–º–∏
    config['vad']['speech_pad_ms'] = 200  # –ú–µ–Ω—å—à–µ –æ—Ç—Å—Ç—É–ø–æ–≤
    
    # –î–∏–∞—Ä–∏–∑–∞—Ü–∏—è - –æ—Ç–∫–ª—é—á–∞–µ–º –¥–ª—è –ø–µ—Å–µ–Ω
    config['diarization']['is_diarize'] = False
    
    # BGM —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ - –æ—Å—Ç–∞–≤–ª—è–µ–º –≤–∫–ª—é—á–µ–Ω–Ω—ã–º –¥–ª—è –ø–µ—Å–µ–Ω
    config['bgm_separation']['is_separate_bgm'] = True
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    with open(config_file, 'w', encoding='utf-8') as f:
        yaml.dump(config, f, default_flow_style=False, allow_unicode=True, sort_keys=False)
    
    print("‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è –ø–µ—Å–µ–Ω")
    return True

def create_song_specific_config():
    """–°–æ–∑–¥–∞–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –ø–µ—Å–µ–Ω"""
    
    song_config = {
        'whisper': {
            'model_size': 'large-v3',
            'lang': 'russian',
            'is_translate': False,
            'beam_size': 5,
            'log_prob_threshold': -0.5,
            'no_speech_threshold': 0.4,
            'compute_type': 'float16',
            'best_of': 5,
            'patience': 1.0,
            'condition_on_previous_text': True,
            'prompt_reset_on_temperature': 0.5,
            'initial_prompt': (
                "–≠—Ç–æ –ø–µ—Å–Ω—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ—á–Ω—ã–º, —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ä–∏—Ñ–º—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã. "
                "–í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ —Å–ª—É—à–∞–π –∫–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ –∏ —Ñ—Ä–∞–∑—É. –ü–µ—Å–Ω—è –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –ø—Ä–∏–ø–µ–≤—ã –∏ –∫—É–ø–ª–µ—Ç—ã. "
                "–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–π –≤–µ—Å—å —Ç–µ–∫—Å—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é, –≤–∫–ª—é—á–∞—è –≤—Å–µ –∫—É–ø–ª–µ—Ç—ã –∏ –ø—Ä–∏–ø–µ–≤—ã."
            ),
            'temperature': 0.0,
            'compression_ratio_threshold': 2.4,
            'length_penalty': 1.0,
            'repetition_penalty': 1.0,
            'no_repeat_ngram_size': 0,
            'prefix': None,
            'suppress_blank': True,
            'suppress_tokens': '[-1]',
            'max_initial_timestamp': 1.0,
            'word_timestamps': True,
            'prepend_punctuations': '"''"¬ø([{-',
            'append_punctuations': '"''.„ÄÇ,Ôºå!ÔºÅ?Ôºü:Ôºö")]}„ÄÅ',
            'max_new_tokens': None,
            'chunk_length': 60,
            'hallucination_silence_threshold': None,
            'hotwords': (
                "—Å–æ–ª–Ω–µ—á–Ω—ã–π, –∫—Ä—É–≥, –Ω–µ–±–æ, –≤–æ–∫—Ä—É–≥, —Ä–∏—Å—É–Ω–æ–∫, –º–∞–ª—å—á–∏—à–∫–∞, –Ω–∞—Ä–∏—Å–æ–≤–∞–ª, –ª–∏—Å—Ç–æ–∫, –ø–æ–¥–ø–∏—Å–∞–ª, —É–≥–æ–ª–æ–∫, "
                "–ø—É—Å—Ç—å, –≤—Å–µ–≥–¥–∞, —Å–æ–ª–Ω—Ü–µ, –º–∞–º–∞, –±—É–¥—É, –º–∏–ª—ã–π, –¥—Ä—É–≥, –¥–æ–±—Ä—ã–π, –ª—é–¥–∏, —Ö–æ—á–µ—Ç—Å—è, –º–∏—Ä–∞, —Ç—Ä–∏–¥—Ü–∞—Ç—å, "
                "–ø—è—Ç—å, —Å–µ—Ä–¥—Ü–µ, –æ–ø—è—Ç—å, —É—Å—Ç–∞–µ—Ç, –ø–æ–≤—Ç–æ—Ä—è—Ç—å, —Ç–∏—à–µ, —Å–æ–ª–¥–∞—Ç, —Å–ª—ã—à–∏—à—å, –ø—É–≥–∞—é—Ç—Å—è, –≤–∑—Ä—ã–≤–æ–≤, "
                "—Ç—ã—Å—è—á–∏, –≥–ª–∞–∑, –≥–ª—è–¥—è—Ç, –≥—É–±—ã, —É–ø—Ä—è–º–æ, —Ç–≤–µ—Ä–¥—è—Ç, –ø—Ä–æ—Ç–∏–≤, –±–µ–¥—ã, –≤–æ–π–Ω—ã, –≤—Å—Ç–∞–Ω–µ–º, –º–∞–ª—å—á–∏—à–µ–∫, "
                "—Å—á–∞—Å—Ç—å–µ, –Ω–∞–≤–µ–∫, –ø–æ–≤–µ–ª–µ–ª, —á–µ–ª–æ–≤–µ–∫"
            ),
            'language_detection_threshold': 0.5,
            'language_detection_segments': 1,
            'batch_size': 24,
            'enable_offload': True,
            'add_timestamp': False,
            'file_format': 'SRT'
        },
        'vad': {
            'vad_filter': False,  # –û—Ç–∫–ª—é—á–∞–µ–º –¥–ª—è –ø–µ—Å–µ–Ω
            'threshold': 0.3,
            'min_speech_duration_ms': 100,
            'max_speech_duration_s': 9999,
            'min_silence_duration_ms': 500,
            'speech_pad_ms': 200
        },
        'diarization': {
            'is_diarize': False,  # –û—Ç–∫–ª—é—á–∞–µ–º –¥–ª—è –ø–µ—Å–µ–Ω
            'diarization_device': 'cuda',
            'hf_token': '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',
            'enable_offload': True
        },
        'bgm_separation': {
            'is_separate_bgm': True,  # –í–∫–ª—é—á–∞–µ–º –¥–ª—è –ø–µ—Å–µ–Ω
            'uvr_model_size': 'UVR-MDX-NET-Inst_HQ_4',
            'uvr_device': 'cuda',
            'segment_size': 256,
            'save_file': False,
            'enable_offload': True
        }
    }
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –ø–µ—Å–µ–Ω
    with open('configs/song_parameters.yaml', 'w', encoding='utf-8') as f:
        yaml.dump(song_config, f, default_flow_style=False, allow_unicode=True, sort_keys=False)
    
    print("‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –ø–µ—Å–µ–Ω: configs/song_parameters.yaml")

def main():
    print("üéµ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Whisper WebUI –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ø–µ—Å–µ–Ω")
    print("=" * 55)
    
    # –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    if optimize_for_songs():
        print("‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã")
    else:
        print("‚ùå –û—à–∏–±–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏")
        return False
    
    # –°–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –ø–µ—Å–µ–Ω
    create_song_specific_config()
    
    print("\nüéØ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –¥–ª—è –ø–µ—Å–µ–Ω:")
    print("1. ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–∞ –¥–ª–∏–Ω–∞ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ (chunk_length: 60)")
    print("2. ‚úÖ –û—Ç–∫–ª—é—á–µ–Ω VAD —Ñ–∏–ª—å—Ç—Ä (–º–æ–∂–µ—Ç –æ–±—Ä–µ–∑–∞—Ç—å –≤–∞–∂–Ω—ã–µ —á–∞—Å—Ç–∏)")
    print("3. ‚úÖ –û—Ç–∫–ª—é—á–µ–Ω–∞ –¥–∏–∞—Ä–∏–∑–∞—Ü–∏—è (–Ω–µ –Ω—É–∂–Ω–∞ –¥–ª—è –ø–µ—Å–µ–Ω)")
    print("4. ‚úÖ –í–∫–ª—é—á–µ–Ω–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ BGM (–æ—Ç–¥–µ–ª–µ–Ω–∏–µ –≤–æ–∫–∞–ª–∞)")
    print("5. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã hotwords –∏–∑ –ø–µ—Å–Ω–∏")
    print("6. ‚úÖ –£–ª—É—á—à–µ–Ω initial_prompt –¥–ª—è –ø–µ—Å–µ–Ω")
    print("7. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–æ—Ä–æ–≥–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ —Ä–µ—á–∏")
    print("8. ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω—ã –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è (–≤–∞–∂–Ω–æ –¥–ª—è –ø—Ä–∏–ø–µ–≤–æ–≤)")
    
    print("\nüöÄ –î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ WebUI:")
    print("   ./start_optimal.sh")
    
    print("\nüí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:")
    print("1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫—É –∞—É–¥–∏–æ (–≤–∫–ª—é—á–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)")
    print("2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∞—É–¥–∏–æ —Ö–æ—Ä–æ—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞")
    print("3. –î–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –ø–µ—Å–µ–Ω –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏")
    print("4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ BGM —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
    
    return True

if __name__ == "__main__":
    main()
